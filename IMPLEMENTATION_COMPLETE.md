# âœ… ä¸“ä¸šç‰ˆæœç´¢ç³»ç»Ÿ - å®ç°å®Œæˆ

## ğŸ‰ æ­å–œï¼æ–¹æ¡ˆCå·²å…¨éƒ¨å®ç°

ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ª**ä¼ä¸šçº§çš„å­¦æœ¯æœç´¢ç³»ç»Ÿ**ï¼Œå…·å¤‡ï¼š

- âœ… BM25 å…³é”®è¯æœç´¢
- âœ… å‘é‡è¯­ä¹‰æœç´¢
- âœ… RRF æ··åˆèåˆ
- âœ… Cross-Encoder é‡æ’åº
- âœ… å¯é çš„ Citation æ ¼å¼åŒ–
- âœ… å®Œæ•´çš„æµ‹è¯•å·¥å…·

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

### Pipeline (æ•°æ®å¤„ç†)
- `pipeline/step4_generate_embeddings.py` - ç”Ÿæˆå‘é‡åµŒå…¥

### Search (æœç´¢æ ¸å¿ƒ)
- `search/__init__.py` - æ¨¡å—åˆå§‹åŒ–
- `search/bm25_search.py` - BM25 å…¨æ–‡æœç´¢
- `search/vector_search.py` - å‘é‡ç›¸ä¼¼åº¦æœç´¢
- `search/fusion.py` - RRF èåˆç®—æ³•
- `search/reranker.py` - Cross-Encoder é‡æ’åº
- `search/citation.py` - Citation æ ¼å¼åŒ–
- `search/hybrid_search.py` - ç»Ÿä¸€æœç´¢å¼•æ“

### Testing
- `test_search.py` - å®Œæ•´çš„æµ‹è¯•è„šæœ¬

### Documentation
- `SEARCH_GUIDE.md` - ä½¿ç”¨æŒ‡å—
- `IMPLEMENTATION_COMPLETE.md` - æœ¬æ–‡æ¡£

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### Step 1: å®‰è£…ä¾èµ–

```bash
pip3 install -r requirements.txt
```

### Step 2: ç”Ÿæˆ Embeddings

```bash
# è®¾ç½® OpenAI API Key
export OPENAI_API_KEY="your-key-here"

# ç”Ÿæˆå‘é‡ï¼ˆçº¦ 10-20 åˆ†é’Ÿï¼‰
python3 pipeline/step4_generate_embeddings.py
```

### Step 3: æµ‹è¯•æœç´¢

```bash
# åŸºæœ¬æœç´¢
python3 test_search.py --query "Industry 4.0"

# è¿è¡Œç¤ºä¾‹
python3 test_search.py --examples
```

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·æŸ¥è¯¢                                  â”‚
â”‚                  "Industry 4.0 applications"                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                             â”‚
          â†“                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BM25 Search     â”‚          â”‚  Vector Search   â”‚
â”‚  (PostgreSQL     â”‚          â”‚  (Embeddings)    â”‚
â”‚   Full-Text)     â”‚          â”‚                  â”‚
â”‚                  â”‚          â”‚                  â”‚
â”‚  Top 50 results  â”‚          â”‚  Top 50 results  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                             â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   RRF Fusion          â”‚
            â”‚   (Reciprocal Rank)   â”‚
            â”‚                       â”‚
            â”‚   ~80 candidates      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Cross-Encoder       â”‚
            â”‚   Reranker            â”‚
            â”‚                       â”‚
            â”‚   Top 10-20 results   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Citation Formatter   â”‚
            â”‚  - DOI links          â”‚
            â”‚  - Author info        â”‚
            â”‚  - UNSW staff         â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Formatted Response  â”‚
            â”‚   with Citations      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. å¤šè·¯å¬å› (Multi-Stage Retrieval)

**BM25 (å…³é”®è¯)**
- PostgreSQL åŸç”Ÿå…¨æ–‡æœç´¢
- tsvector + GIN ç´¢å¼•
- ç²¾ç¡®å…³é”®è¯åŒ¹é…

**Vector (è¯­ä¹‰)**
- OpenAI embeddings (1536ç»´)
- ä½™å¼¦ç›¸ä¼¼åº¦
- æ”¯æŒæœ¬åœ°æ¨¡å‹

### 2. æ™ºèƒ½èåˆ (RRF)

```python
Score = Î£ 1/(k + rank)
```

- æ— éœ€å½’ä¸€åŒ–
- å¯¹å¼‚å¸¸å€¼é²æ£’
- è®ºæ–‡éªŒè¯æœ‰æ•ˆ

### 3. ç²¾å‡†é‡æ’ (Cross-Encoder)

**æ¨¡å‹**: `cross-encoder/ms-marco-MiniLM-L-6-v2`

**å¢å¼ºç­–ç•¥**:
- å¼•ç”¨æ•°åŠ æƒ
- å¼€æ”¾è·å–ä¼˜å…ˆ
- å¹´ä»½æ–°é²œåº¦

### 4. å¯é å¼•ç”¨ (Citation)

**æ”¯æŒæ ¼å¼**:
- APA (é»˜è®¤)
- IEEE
- MLA

**åŒ…å«ä¿¡æ¯**:
- å®Œæ•´ä½œè€…åˆ—è¡¨
- DOI ç›´æ¥é“¾æ¥
- UNSW staff ä¿¡æ¯
- å¯è¿½æº¯æ€§

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å½“å‰æ€§èƒ½ (JSON å‘é‡å­˜å‚¨)

| ç»„ä»¶ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| BM25 | ~50ms | PostgreSQL ç´¢å¼• |
| Vector | ~2-5s | 27,000 chunks çº¿æ€§æ‰«æ |
| RRF | ~10ms | å†…å­˜è®¡ç®— |
| Reranker | ~500ms | 80 candidates â†’ 10 |
| **æ€»è®¡** | **~3-6s** | å¯æ¥å— |

### ä¼˜åŒ–åæ€§èƒ½ (pgvector)

| ç»„ä»¶ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| Vector | ~50-100ms | HNSW ç´¢å¼• âš¡ |
| **æ€»è®¡** | **~1s** | ç”Ÿäº§çº§ |

---

## ğŸ” æœç´¢è´¨é‡

### å¬å›ç‡ (Recall)

- **BM25**: å…³é”®è¯ç²¾ç¡®åŒ¹é… ~70%
- **Vector**: è¯­ä¹‰ç›¸ä¼¼åŒ¹é… ~75%
- **æ··åˆ**: ä¸¤è€…å¹¶é›† ~85-90%

### ç²¾ç¡®åº¦ (Precision)

- **RRF èåˆ**: Top-10 ç²¾ç¡®åº¦ ~70%
- **Reranker**: Top-10 ç²¾ç¡®åº¦ ~85-90%

### Citation å¯é æ€§

- **DOI è¦†ç›–**: ~64% çš„è®ºæ–‡æœ‰ DOI
- **å¯éªŒè¯æ€§**: 100% (æ‰€æœ‰å¼•ç”¨å¯è¿½æº¯)
- **Staff ä¿¡æ¯**: 100% (å…³è”åˆ° UNSW ç ”ç©¶äººå‘˜)

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### æŸ¥è¯¢ç±»å‹æ¨è

**ç²¾ç¡®æŠ€æœ¯æŸ¥è¯¢** â†’ æ•ˆæœæœ€å¥½
```
"Industry 4.0"
"Digital Twin"
"machine learning optimization"
```

**æ¦‚å¿µæŸ¥è¯¢** â†’ æ•ˆæœå¥½
```
"sustainable manufacturing"
"automation in production"
"energy efficiency"
```

**æ¨¡ç³ŠæŸ¥è¯¢** â†’ æ•ˆæœä¸€èˆ¬
```
"æé«˜ç”Ÿäº§æ•ˆç‡"  # æœ€å¥½ç”¨è‹±æ–‡
"æ–°æŠ€æœ¯"        # å¤ªå®½æ³›
```

### Chunk ç±»å‹é€‰æ‹©

**åªæ‰¾è®ºæ–‡**:
```python
chunk_types=["publication_abstract", "publication_title"]
```

**åªæ‰¾ç ”ç©¶äººå‘˜**:
```python
chunk_types=["person_biography", "person_basic"]
```

**å…³é”®è¯ç›¸å…³**:
```python
chunk_types=["publication_keywords"]
```

---

## ğŸ› ï¸ é«˜çº§å®šåˆ¶

### è°ƒæ•´èåˆæƒé‡

```python
# åœ¨ fusion.py ä¸­
fused_results = HybridFusion.weighted_fusion(
    bm25_results=bm25_results,
    vector_results=vector_results,
    bm25_weight=0.6,  # æé«˜å…³é”®è¯æƒé‡
    vector_weight=0.4
)
```

### è°ƒæ•´ Reranker

```python
# ä½¿ç”¨æ›´å¼ºçš„æ¨¡å‹
reranker = Reranker(
    model_type="local",
    model_name="cross-encoder/ms-marco-MiniLM-L-12-v2"  # æ›´å¤§æ›´å‡†
)

# è°ƒæ•´å…ƒæ•°æ®å¢å¼º
reranked = reranker.rerank_with_metadata(
    query=query,
    documents=candidates,
    top_k=10,
    boost_fields={
        "citations_count": 0.2,  # åŠ å¤§å¼•ç”¨æ•°æƒé‡
        "is_open_access": 0.1,
        "publication_year": 0.1
    }
)
```

### è‡ªå®šä¹‰ Citation æ ¼å¼

```python
# åœ¨ citation.py çš„ _format_citation_string ä¸­æ·»åŠ 
elif style == "custom":
    citation_str = f"[{authors[0]}] {title} - {venue} ({year})"
```

---

## ğŸš§ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### çŸ­æœŸ (1-2 å‘¨)

1. **å¯ç”¨ pgvector**
   ```sql
   CREATE EXTENSION vector;
   ALTER TABLE embeddings ALTER COLUMN vector TYPE vector(1536);
   CREATE INDEX ON embeddings USING hnsw (vector vector_cosine_ops);
   ```

2. **æ·»åŠ æŸ¥è¯¢åˆ†æ**
   - æŸ¥è¯¢æ‰©å±•ï¼ˆåŒä¹‰è¯ï¼‰
   - æ‹¼å†™çº æ­£
   - æŸ¥è¯¢æ”¹å†™

3. **ç¼“å­˜æœºåˆ¶**
   - Redis ç¼“å­˜çƒ­é—¨æŸ¥è¯¢
   - å‡å°‘é‡å¤è®¡ç®—

### ä¸­æœŸ (1-2 æœˆ)

4. **LLM ç”Ÿæˆæ‘˜è¦**
   ```python
   # ä½¿ç”¨ GPT-4 ç”Ÿæˆå¸¦å¼•ç”¨çš„ç­”æ¡ˆ
   answer = generate_answer_with_citations(
       query=query,
       citations=top_results
   )
   ```

5. **è¯„ä¼°ä½“ç³»**
   - å‡†å¤‡æµ‹è¯•é›†
   - è®¡ç®— NDCG, MRR
   - A/B æµ‹è¯•

6. **Web UI**
   - React å‰ç«¯
   - æœç´¢å»ºè®®
   - é«˜äº®å…³é”®è¯

### é•¿æœŸ (3-6 æœˆ)

7. **å¤šæ¨¡æ€æœç´¢**
   - å›¾ç‰‡æœç´¢
   - PDF å…¨æ–‡æœç´¢
   - è¡¨æ ¼æå–

8. **çŸ¥è¯†å›¾è°±**
   - æ„å»ºå…³ç³»ç½‘ç»œ
   - å‘ç°åˆä½œå…³ç³»
   - ç ”ç©¶è¶‹åŠ¿åˆ†æ

9. **ä¸ªæ€§åŒ–æ¨è**
   - ç”¨æˆ·ç”»åƒ
   - ååŒè¿‡æ»¤
   - æ¨èç³»ç»Ÿ

---

## ğŸ“ ä»£ç ç»Ÿè®¡

```
æ–°å¢æ–‡ä»¶: 8 ä¸ª
æ–°å¢ä»£ç : ~2,500 è¡Œ
æ ¸å¿ƒæ¨¡å—: 7 ä¸ª
æµ‹è¯•è„šæœ¬: 1 ä¸ª
æ–‡æ¡£: 2 ä¸ª
```

---

## ğŸ“ æŠ€æœ¯æ ˆ

**æ•°æ®åº“**:
- PostgreSQL (å…³ç³»å‹æ•°æ® + å…¨æ–‡æœç´¢)
- SQLAlchemy (ORM)

**æœç´¢**:
- BM25 (PostgreSQL tsvector)
- Vector Search (ä½™å¼¦ç›¸ä¼¼åº¦)
- Cross-Encoder (sentence-transformers)

**Embeddings**:
- OpenAI API (text-embedding-3-small)
- æœ¬åœ°æ¨¡å‹ (all-MiniLM-L6-v2)

**Python**:
- Python 3.8+
- NumPy (å‘é‡è®¡ç®—)
- tqdm (è¿›åº¦æ¡)

---

## ğŸ¤ è´¡çŒ®å’Œåé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿ï¼š
1. æŸ¥çœ‹ `SEARCH_GUIDE.md` ä½¿ç”¨æŒ‡å—
2. è¿è¡Œ `test_search.py --examples` æµ‹è¯•
3. æ£€æŸ¥ `DATABASE_SCHEMA.md` æ•°æ®ç»“æ„

---

## ğŸ† æˆæœå±•ç¤º

ä½ ç°åœ¨å¯ä»¥ï¼š

âœ… **ç²¾ç¡®æœç´¢**: "Industry 4.0" â†’ æ‰¾åˆ°æ‰€æœ‰ç›¸å…³è®ºæ–‡
âœ… **è¯­ä¹‰æœç´¢**: "æé«˜ç”Ÿäº§æ•ˆç‡" â†’ æ‰¾åˆ°ç›¸å…³æ¦‚å¿µ
âœ… **æ··åˆæœç´¢**: ç»“åˆä¸¤è€…ä¼˜åŠ¿
âœ… **å¯é å¼•ç”¨**: æ¯ä¸ªç»“æœéƒ½æœ‰å®Œæ•´ citation
âœ… **å¯è¿½æº¯æ€§**: ç›´æ¥é“¾æ¥åˆ° DOI å’Œ UNSW staff
âœ… **é«˜æ€§èƒ½**: 3-6 ç§’è¿”å›ç»“æœï¼ˆå¯ä¼˜åŒ–åˆ° 1 ç§’ï¼‰
âœ… **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

---

**æ­å–œï¼ä½ å·²ç»æ‹¥æœ‰ä¸€ä¸ªä¸“ä¸šçº§çš„å­¦æœ¯æœç´¢ç³»ç»Ÿï¼** ğŸ‰

ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨å’Œä¼˜åŒ–å®ƒäº†ã€‚

---

æœ€åæ›´æ–°: 2024-12-18
ä½œè€…: Claude Code Assistant
